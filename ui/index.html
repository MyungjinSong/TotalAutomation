<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>통합자동화</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Custom Title Bar -->
    <div id="title-bar">
        <div id="title-drag-area">
            <span id="app-title">통합자동화 v3.0</span>
        </div>
        <div id="window-controls">
            <div class="control-btn" id="btn-min" onclick="window.minimizeWindow()">
                <svg viewBox="0 0 10 1">
                    <path d="M0 0h10v1H0z" />
                </svg>
            </div>
            <div class="control-btn close-btn" id="btn-close" onclick="window.closeWindow()">
                <svg viewBox="0 0 10 10">
                    <path d="M0 0l10 10M10 0L0 10" stroke="currentColor" stroke-width="1.2" />
                </svg>
            </div>
        </div>
    </div>

    <!-- Login Container -->
    <div id="login-container">

        <!-- View 1: User Selection -->
        <div id="login-view" class="login-card">
            <h2>사용자 선택</h2>
            <div id="user-list-container">
                <!-- Javascript populated -->
            </div>
            <div class="login-footer">
                <button id="btn-next" class="primary-btn" onclick="moveToPasswordView()"
                    style="width:100%; margin-bottom:10px;" disabled>다음</button>
                <div style="display:flex; gap:10px; width:100%;">
                    <button class="secondary-btn small" onclick="switchView('add')" style="flex:1;">+ 새 사용자</button>
                    <button id="btn-delete" class="secondary-btn small danger" onclick="deleteUser()" style="flex:1;"
                        disabled>삭제</button>
                </div>
            </div>
        </div>

        <!-- View 1.5: Password Entry (Modal-like) -->
        <div id="password-view" class="login-card" style="display: none; position: relative;">
            <button class="icon-back-btn" onclick="backToUserList()" title="뒤로가기">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" fill="currentColor" />
                </svg>
            </button>

            <h2 id="pwd-user-name" style="margin-top: 20px;">User Name</h2>
            <p id="pwd-user-id" style="text-align:center; color:#666; margin-top:-10px;">(User ID)</p>

            <div class="login-input-area" style="width: 100%; margin: 20px 0;">
                <input type="password" id="login-pw2" placeholder="2차 비밀번호를 입력하세요" class="full-width-input"
                    onkeydown="handleLoginKey(event)">
            </div>

            <div class="login-actions" style="justify-content: center; display: flex;">
                <button class="primary-btn" onclick="tryLogin()" style="width: 100%;">로그인</button>
            </div>
        </div>

        <!-- View 2: Add User (Registration) -->
        <div id="add-user-view" style="display: none;">
            <h3>새 사용자 등록</h3>
            <div class="form-row">
                <div class="form-group"><label>이름 *</label><input type="text" id="new-name"></div>
                <div class="form-group"><label>사번 *</label><input type="text" id="new-id" maxlength="6"></div>
            </div>

            <div class="form-group"><label>근무조</label>
                <select id="new-team" style="width: 100%;">
                    <option>A조</option>
                    <option>B조</option>
                    <option>C조</option>
                    <option>D조</option>
                    <option>일근</option>
                </select>
            </div>

            <div class="form-row">
                <div class="form-group"><label>통합 PW *</label><input type="password" id="new-webpw"></div>
                <div class="form-group"><label>확인 *</label><input type="password" id="new-webpw2"></div>
            </div>

            <div class="form-row">
                <div class="form-group"><label>2차 PW *</label><input type="password" id="new-pw2" maxlength="6"></div>
                <div class="form-group"><label>확인 *</label><input type="password" id="new-pw2-confirm" maxlength="6">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group"><label>SAP PW</label><input type="password" id="new-sappw"></div>
                <div class="form-group"><label>확인</label><input type="password" id="new-sappw2"></div>
            </div>

            <div class="actions" style="margin-top: 10px;">
                <button class="primary-btn" onclick="submitNewUser()">등록</button>
                <button class="secondary-btn" onclick="switchView('login')">취소</button>
            </div>
        </div>

    </div>

    <!-- Main Container (Hidden Initially) -->
    <div id="app-container" style="display: none;">
        <!-- Sidebar -->
        <nav id="sidebar">
            <div class="nav-top">
                <div class="menu-item active" data-target="view-daily-log" onclick="switchMainTab('view-daily-log')">
                    <span class="icon">📅</span>
                    <span class="label">일지생성</span>
                </div>
                <div class="menu-item" data-target="view-erp-check" onclick="switchMainTab('view-erp-check')">
                    <span class="icon">📋</span>
                    <span class="label">ERP일일점검</span>
                </div>
                <div class="menu-item" data-target="view-track-access" onclick="switchMainTab('view-track-access')">
                    <span class="icon">🚧</span>
                    <span class="label">선로출입관리</span>
                </div>
                <div class="menu-item" data-target="view-vehicle-log" onclick="switchMainTab('view-vehicle-log')">
                    <span class="icon">🚗</span>
                    <span class="label">차량운행일지</span>
                </div>
            </div>
            <div class="nav-bottom">
                <div class="menu-item settings-btn" onclick="openSettings()">
                    <span class="icon">⚙️</span>
                    <span class="label">설정</span>
                </div>
            </div>
        </nav>

        <!-- Content Area -->
        <main id="content">
            <!-- Daily Log View -->
            <div id="view-daily-log" class="view-section active">
                <h1>일지생성</h1>
                <div class="daily-log-container">
                    <div class="daily-log-main">
                        <!-- Left Column: Controls -->
                        <div class="left-col">
                            <div class="control-box">
                                <label>근무 스케줄</label>
                                <div class="option-group">
                                    <label class="radio-label">
                                        <input type="radio" name="work-type" value="day" id="radio-work-type-day"
                                            onchange="handleWorkTypeChange()">
                                        <span>주간</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="work-type" value="night" id="radio-work-type-night"
                                            onchange="handleWorkTypeChange()">
                                        <span>야간</span>
                                    </label>
                                </div>
                            </div>

                            <div class="control-box expanded-box">
                                <label>자동화 실행 목록</label>
                                <div class="option-group checkbox-group vertical-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="chk-make-log">
                                        <span>일지생성</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="chk-general" checked>
                                        <span>일반업무</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="chk-safe-manage" checked>
                                        <span>안전관리</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="chk-driving">
                                        <span>운전적합성 점검표</span>
                                    </label>
                                </div>
                            </div>

                            <div class="control-box">
                                <label>추가 옵션</label>
                                <div class="option-group vertical-group">
                                    <label class="checkbox-label" id="lbl-drink">
                                        <input type="checkbox" id="chk-drink" onchange="toggleDrinkCalibration()">
                                        <span>주간 음주측정</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="chk-drink-cal" disabled>
                                        <span>음주측정기 교정</span>
                                    </label>
                                </div>
                            </div>

                        </div>

                        <!-- Right Column: Worker List -->
                        <div class="right-col">
                            <div class="control-box" style="height: 100%;">
                                <label>근무자</label>
                                <div class="worker-list-wrap"
                                    style="flex: 1; border: 1px solid #e0e0e0; border-radius: 8px; background: #fff; display: flex; flex-direction: column; overflow: hidden;">
                                    <div class="worker-list-header">
                                        <div class="wl-name">이름</div>
                                        <div class="wl-note">휴가/비고</div>
                                        <div class="wl-drive hidden-col" id="col-header-drive">운전</div>
                                    </div>
                                    <div id="daily-worker-list" class="worker-list-body">
                                        <!-- Dynamic Content -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Separate Footer for Start Button -->
                    <div class="daily-log-footer">
                        <button class="primary-btn large-btn" onclick="startDailyLog()">시작</button>
                    </div>
                </div>
            </div>

            <!-- ERP Check View -->
            <div id="view-erp-check" class="view-section">
                <!-- Compact header if needed or keep h1 but less margin -->
                <h1>ERP일일점검</h1>
                <div class="erp-container savable-ui" data-save-key="erpLocation">
                    <div class="erp-compact-layout">
                        <!-- Row 1: Substation -->
                        <div class="erp-row">
                            <div class="erp-label-col">변전소</div>
                            <div class="erp-content-col">
                                <div class="erp-grid-3" id="grid-substation"></div>
                            </div>
                        </div>

                        <!-- Row 2: Electric Room -->
                        <div class="erp-row">
                            <div class="erp-label-col">전기실</div>
                            <div class="erp-content-col">
                                <div class="erp-group-container">
                                    <div class="erp-group-stack">
                                        <div class="erp-sub-header">그룹 1</div>
                                        <div class="erp-btn-stack" id="elec-g1"></div>
                                    </div>
                                    <div class="erp-group-stack">
                                        <div class="erp-sub-header">그룹 2</div>
                                        <div class="erp-btn-stack" id="elec-g2"></div>
                                    </div>
                                    <div class="erp-group-stack">
                                        <div class="erp-sub-header">그룹 3</div>
                                        <div class="erp-btn-stack" id="elec-g3"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Row 3: Etc -->
                        <div class="erp-row">
                            <div class="erp-label-col">기타업무</div>
                            <div class="erp-content-col">
                                <div class="erp-grid-3" id="grid-etc"></div>
                            </div>
                        </div>
                    </div>

                    <div class="erp-footer">
                        <div class="worker-format-toggle-container">
                            <span class="toggle-label-text" id="lbl-format-summary">대표자 외 0명</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="toggle-worker-format" class="savable-ui"
                                    data-save-key="workerFormat" onchange="updateToggleStyle()">
                                <span class="slider round"></span>
                            </label>
                            <span class="toggle-label-text" id="lbl-format-list">전원 나열식</span>
                        </div>
                        <div class="erp-action-buttons">
                            <button class="secondary-btn" id="btn-erp-mode" onclick="toggleERPMode()">일괄모드 &gt;</button>
                            <button class="primary-btn large-btn" onclick="openERPWorkerModal()">시작</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Track Access View -->
            <div id="view-track-access" class="view-section">
                <h1>선로출입관리</h1>
                <div class="card">
                    <button class="primary-btn" onclick="runTask('TrackAccess')">시작</button>
                </div>
            </div>

            <!-- Vehicle Log View -->
            <div id="view-vehicle-log" class="view-section">
                <h1>차량운행일지</h1>
                <div class="card">
                    <!-- Placeholder -->
                    <p>준비 중입니다.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Settings Overlay View (Hidden Initially) -->
    <div id="settings-view" style="display: none;">
        <div class="settings-header">
            <button class="back-btn" onclick="closeSettings()">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" fill="currentColor" />
                </svg>
                <span class="settings-title">설정</span>
            </button>
        </div>

        <div class="settings-body">
            <!-- Settings Tabs Sidebar -->
            <div class="settings-sidebar">
                <div class="tab-item active" onclick="switchSettingsTab('tab-user')">유저정보</div>
                <div class="tab-item" onclick="switchSettingsTab('tab-worker')">작업자</div>
                <div class="tab-item" onclick="switchSettingsTab('tab-location')">작업장소</div>
                <div class="tab-item" onclick="switchSettingsTab('tab-hotkey')">단축키</div>
                <div class="tab-item" onclick="switchSettingsTab('tab-preset')">프리셋</div>
                <div class="tab-item" onclick="switchSettingsTab('tab-updates')">업데이트 내역</div>
            </div>

            <div class="settings-content-area">

                <!-- Tab 1: User Info -->
                <div id="tab-user" class="settings-tab-pane active">
                    <h2>내 정보</h2>
                    <div class="form-group inline-field"><label>이름</label><input type="text" id="user-name" readonly
                            disabled></div>
                    <div class="form-group inline-field"><label>사번</label><input type="text" id="user-id" readonly
                            disabled></div>
                    <div class="form-group inline-field"><label>분소</label><input type="text" id="user-dept"></div>
                    <div class="form-group inline-field"><label>근무조</label>
                        <select id="user-team">
                            <option>A조</option>
                            <option>B조</option>
                            <option>C조</option>
                            <option>D조</option>
                            <option>일근</option>
                        </select>
                    </div>
                    <hr>
                    <h3>비밀번호 관리</h3>
                    <div class="form-group inline-field"><label>통합 PW</label><input type="password" id="user-webpw">
                    </div>
                    <div class="form-group inline-field"><label>2차 PW</label><input type="password" id="user-pw2"
                            maxlength="6"></div>
                    <div class="form-group inline-field"><label>SAP PW</label><input type="password" id="user-sappw">
                    </div>
                </div>

                <!-- Tab 2: Workers -->
                <div id="tab-worker" class="settings-tab-pane">
                    <div class="tab-header">
                        <h2>분소원</h2>
                    </div>
                    <div class="table-wrapper">
                        <table id="worker-table">
                            <thead>
                                <tr>
                                    <th width="15%">이름</th>
                                    <th width="15%">사번</th>
                                    <th width="15%">근무조</th>
                                    <th width="20%">전화번호</th>
                                    <th width="10%">분소장</th>
                                    <th width="15%">운전원</th>
                                    <th width="10%">삭제</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <button class="add-row-btn" onclick="addWorkerRow()">+ 추가</button>
                </div>

                <!-- Tab 3: Locations -->
                <div id="tab-location" class="settings-tab-pane">
                    <div class="tab-header" style="display:flex; justify-content:space-between; align-items:center;">
                        <h2>ERP점검</h2>
                        <div style="font-size:14px;">
                            점검자 표시형식 :
                            <select id="erp-format-pref" style="margin-left:5px; padding:2px;"
                                onchange="autoSaveSettings()">
                                <option value="summary">대표자 외 N명</option>
                                <option value="list">전원 나열식</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table id="location-table">
                            <thead>
                                <tr>
                                    <th width="40%">점검장소</th>
                                    <th width="20%">오더번호</th>
                                    <th width="30%">구분</th>
                                    <th width="10%">삭제</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <button class="add-row-btn" onclick="addLocationRow()">+ 추가</button>
                </div>

                <!-- Tab 4: Hotkeys -->
                <div id="tab-hotkey" class="settings-tab-pane">
                    <h2>단축키 설정</h2>
                    <div class="table-wrapper">
                        <table id="hotkey-table">
                            <thead>
                                <tr>
                                    <th width="30%">기능</th>
                                    <th width="25%">단축키</th>
                                    <th width="35%">설명</th>
                                    <th width="10%" class="center">활성</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab 5: Presets -->
                <div id="tab-preset" class="settings-tab-pane">
                    <h2>선로출입 프리셋</h2>
                    <div class="form-group">
                        <label>프리셋 선택</label>
                        <select id="preset-selector" onchange="loadPresetDetail()"></select>
                    </div>
                    <div class="form-group">
                        <label>프리셋 이름</label>
                        <input type="text" id="ps-name">
                    </div>
                    <div class="form-group">
                        <label>작업 내용</label>
                        <textarea id="ps-work" rows="5"></textarea>
                    </div>
                    <div class="actions center"><button class="primary-btn" onclick="saveSettings()">저장</button></div>
                </div>

                <!-- Tab 6: Update History -->
                <div id="tab-updates" class="settings-tab-pane">
                    <div class="tab-header">
                        <h2>업데이트 내역</h2>
                        <button class="secondary-btn small" onclick="requestReleaseNotes()">새로고침</button>
                    </div>
                    <div id="release-list" class="release-list-container">
                        <div class="loading-spinner">로딩 중...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ERP Worker Selection Modal -->
    <div id="erp-worker-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>점검자 선택</h3>
                <button class="close-btn-icon" onclick="closeERPWorkerModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="erp-worker-list" class="worker-list-grid">
                    <!-- Dynamic Content -->
                </div>
                <div class="modal-option-row">
                    <span>점검자 표시형식</span>
                    <button id="btn-erp-modal-toggle" class="text-toggle-btn" onclick="toggleModalWorkerFormat()">
                        대표자 외 0명
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="primary-btn full-width" onclick="submitERPTask()">확인</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>